spring:
  profiles:
    active: test

  datasource:
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5
      minimum-idle: 1
      idle-timeout: 30000
      connection-timeout: 20000
      validation-timeout: 5000
      pool-name: TestHabitTrackerPool
      auto-commit: true
      connection-test-query: SELECT 1

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    show-sql: true
    hibernate:
      ddl-auto: create-drop  # Recreate database for each test
    properties:
      hibernate:
        format_sql: true
        jdbc:
          batch_size: 10
          time_zone: UTC
        order_inserts: true
        order_updates: true
    open-in-view: false

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.xml
    default-schema: public
    liquibase-schema: service
    contexts: test
    parameters:
      search-path: public,service
    test-rollback: true

logging:
  level:
    root: INFO
    com.mkhabibullin: DEBUG
    org.springframework: INFO
    org.springframework.test: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE
    org.testcontainers: INFO
    com.zaxxer.hikari: INFO
    liquibase: INFO
    # Add logging for Spring Web and Security
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    # Add swagger logging
    org.springdoc: DEBUG

# Swagger/OpenAPI settings for test
springdoc:
  api-docs:
    enabled: false  # Disable API docs in test
  swagger-ui:
    enabled: false  # Disable Swagger UI in test
  paths-to-match: /api/**
  packages-to-scan: com.mkhabibullin.presentation.controller
  show-actuator: false

# Server configuration for tests
server:
  port: 0  # Random port for tests
  servlet:
    context-path: /
  forward-headers-strategy: framework

# Web configuration for tests
web:
  cors:
    allowed-origins: "*"
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    max-age: 3600

# Application settings
application:
  test:
    # Test data configuration
    data:
      users:
        default-password: test123
        batch-size: 10
    # Test timeouts
    timeouts:
      global: 5000
      db-operation: 1000
      http: 5000  # Added HTTP timeout
    # Test features toggles
    features:
      use-test-email: true
      mock-external-services: true
      cleanup-after-test: true
      disable-security: true  # Added security disable flag
    # Test database settings
    database:
      schema: public
      clean-before: true
      clean-after: true
    # Audit settings for tests
    audit:
      enabled: true
      detailed-logging: true
      exclude-paths: /v3/api-docs/**,/swagger-ui/**  # Exclude Swagger paths from audit

# Security settings
security:
  test:
    enabled: false
    mock-auth: true
    test-user:
      username: test-user
      password: test-password
      roles: ROLE_USER,ROLE_ADMIN
  jwt:
    enabled: false  # Disable JWT for tests
    secret: test-secret-key
    expiration: 3600

# Test environment settings
test:
  # TestContainers configuration
  containers:
    postgres:
      docker-image: postgres:13
      init-script: db/init-test-db.sql
  # Mock services configuration
  mocks:
    enabled: true
    endpoints:
      base-url: http://localhost
      port: 9561
  # Test data generation
  data:
    generation:
      enabled: true
      seed: 12345
    cleanup:
      enabled: true
      strategy: AFTER_TEST

# Aspect configuration for tests
aspects:
  logging:
    enabled: true
    exclude-patterns:
      - /v3/api-docs/**
      - /swagger-ui/**
  audit:
    enabled: true
    exclude-patterns:
      - /v3/api-docs/**
      - /swagger-ui/**